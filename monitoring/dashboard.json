{
  "displayName": "Piper Newsletter System Dashboard",
  "gridLayout": {
    "columns": 12,
    "widgets": [
      {
        "title": "Request Rate",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"run.googleapis.com/request_count\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "RATE"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Requests/sec",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Response Latency (95th percentile)",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"run.googleapis.com/request_latencies\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_PERCENTILE_95"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Latency (ms)",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Error Rate",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"run.googleapis.com/request_count\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\" metric.label.\"response_code_class\"!=\"2xx\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "RATE"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Errors/sec",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Container Instance Count",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"run.googleapis.com/container/instance_count\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Instances",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "CPU Utilization",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"run.googleapis.com/container/cpu/utilizations\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "CPU %",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Memory Utilization",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"run.googleapis.com/container/memory/utilizations\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Memory %",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Database Connections",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"cloudsql.googleapis.com/database/mysql_connections\" resource.type=\"cloudsql_database\" resource.label.\"database_id\"=\"sarvajaya-genesis-protocol:piper-newsletter-db\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Connections",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Database CPU Utilization",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"cloudsql.googleapis.com/database/cpu/utilization\" resource.type=\"cloudsql_database\" resource.label.\"database_id\"=\"sarvajaya-genesis-protocol:piper-newsletter-db\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "CPU %",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Email Delivery Rate",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"sendgrid.googleapis.com/email/delivered\" resource.type=\"sendgrid_email\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "RATE"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Emails/sec",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Newsletter Subscription Rate",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"custom.googleapis.com/newsletter/subscriptions\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "RATE"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Subscriptions/sec",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "User Registration Rate",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"custom.googleapis.com/user/registrations\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "RATE"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Registrations/sec",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Payment Processing Rate",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"custom.googleapis.com/payment/processed\" resource.type=\"cloud_run_revision\" resource.label.\"service_name\"=\"piper-dispatch-main\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "RATE"
                  }
                }
              }
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "Payments/sec",
            "scale": "LINEAR"
          }
        }
      }
    ]
  }
}